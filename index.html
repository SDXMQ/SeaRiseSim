<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í•œêµ­ í•´ìˆ˜ë©´ ìƒìŠ¹ ì›ì¸ ë¶„ì„ ì‹œë®¬ë ˆì´í„°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', 'Pretendard', sans-serif;
            background-color: #f0f4f8;
        }
        .metric-card {
            background-color: white;
            border-radius: 0.75rem;
            padding: 1.5rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            transition: all 0.3s ease;
        }
        .metric-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -2px rgb(0 0 0 / 0.1);
        }
        .control-card {
            background-color: white;
            border-radius: 0.75rem;
            padding: 1.5rem;
            box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
        }
        .ocean-btn {
            transition: all 0.2s ease;
        }
        .ocean-btn.active {
            background-color: #2563eb;
            color: white;
            font-weight: 600;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #2563eb;
            cursor: pointer;
            border-radius: 50%;
        }
        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #2563eb;
            cursor: pointer;
            border-radius: 50%;
        }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="max-w-7xl mx-auto">
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-800">ğŸ‡°ğŸ‡· í•œêµ­ í•´ìˆ˜ë©´ ìƒìŠ¹ ì›ì¸ ë¶„ì„ ì‹œë®¬ë ˆì´í„°</h1>
            <p class="text-lg text-gray-600 mt-2">ì§€êµ¬ ì˜¨ë‚œí™”ê°€ í•´ìˆ˜ë©´ì— ë¯¸ì¹˜ëŠ” ì˜í–¥ì„ ì§ì ‘ íƒêµ¬í•˜ê³  í•œêµ­ì— ë¯¸ì¹  ì˜í–¥ì„ ì˜ˆì¸¡í•´ë³´ì„¸ìš”.</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Left Panel: Controls -->
            <div class="lg:col-span-1 space-y-6">
                <!-- Global Settings -->
                <div class="control-card">
                    <h3 class="text-xl font-semibold text-gray-700 mb-4 border-b pb-2">ê¸°ë³¸ ì„¤ì •</h3>
                    <div>
                        <label for="futureYear" class="block text-sm font-medium text-gray-700">ì˜ˆì¸¡ ì—°ë„: <span id="futureYearLabel" class="font-bold text-blue-600">2060</span>ë…„</label>
                        <input type="range" id="futureYear" min="2026" max="2100" value="2060" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                    </div>
                    <div class="mt-4">
                        <label for="sspScenario" class="block text-sm font-medium text-gray-700">ê²°ê³¼ê°’ í‘œì‹œ ì‹œë‚˜ë¦¬ì˜¤</label>
                        <select id="sspScenario" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md">
                            <option value="SSP1-2.6">ë§¤ìš° ë‚™ê´€ì  (SSP1-2.6)</option>
                            <option value="SSP2-4.5" selected>ì¤‘ê°„ ì‹œë‚˜ë¦¬ì˜¤ (SSP2-4.5)</option>
                            <option value="SSP5-8.5">ë§¤ìš° ë¹„ê´€ì  (SSP5-8.5)</option>
                        </select>
                        <p class="text-xs text-gray-500 mt-2">â€» ê·¸ë˜í”„ëŠ” ëª¨ë“  ì‹œë‚˜ë¦¬ì˜¤ë¥¼ í•­ìƒ í‘œì‹œí•©ë‹ˆë‹¤.</p>
                    </div>
                </div>

                <!-- Thermal Expansion -->
                <div class="control-card">
                    <h3 class="text-xl font-semibold text-gray-700 mb-4 border-b pb-2"><i class="fas fa-temperature-three-quarters"></i> í•´ìˆ˜ ì—´íŒ½ì°½</h3>
                    <p class="text-xs text-gray-500 mb-4">ë°”ë‹¤ë¥¼ ì„ íƒí•˜ê±°ë‚˜ ì§ì ‘ ê°’ì„ ì¡°ì ˆí•˜ì—¬ ì—´íŒ½ì°½ íš¨ê³¼ë¥¼ í™•ì¸í•˜ì„¸ìš”.</p>
                    <div class="grid grid-cols-3 gap-2 mb-4">
                        <button class="ocean-btn text-sm py-1 px-2 border rounded-md" data-ocean="pacific">íƒœí‰ì–‘</button>
                        <button class="ocean-btn text-sm py-1 px-2 border rounded-md" data-ocean="atlantic">ëŒ€ì„œì–‘</button>
                        <button class="ocean-btn text-sm py-1 px-2 border rounded-md" data-ocean="indian">ì¸ë„ì–‘</button>
                        <button class="ocean-btn text-sm py-1 px-2 border rounded-md" data-ocean="southern">ë‚¨ê·¹í•´</button>
                        <button class="ocean-btn text-sm py-1 px-2 border rounded-md" data-ocean="arctic">ë¶ê·¹í•´</button>
                        <button class="ocean-btn text-sm py-1 px-2 border rounded-md active" data-ocean="custom">ì§ì ‘ì…ë ¥</button>
                    </div>
                    <div>
                        <label for="oceanTemp" class="block text-sm font-medium text-gray-700">í‰ê·  ìˆ˜ì˜¨ (Â°C): <span id="oceanTempLabel" class="font-bold text-blue-600">15.0</span></label>
                        <input type="range" id="oceanTemp" min="-2" max="30" value="15" step="0.1" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                    </div>
                    <div class="mt-4">
                        <label for="oceanSalinity" class="block text-sm font-medium text-gray-700">í‰ê·  ì—¼ë¶„ (PSU): <span id="oceanSalinityLabel" class="font-bold text-blue-600">35.0</span></label>
                        <input type="range" id="oceanSalinity" min="30" max="40" value="35" step="0.1" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                    </div>
                    <div class="mt-4">
                        <label for="oceanDepth" class="block text-sm font-medium text-gray-700">í‰ê·  ìˆ˜ì‹¬ (m): <span id="oceanDepthLabel" class="font-bold text-blue-600">3700</span></label>
                        <input type="range" id="oceanDepth" min="1000" max="6000" value="3700" step="10" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                    </div>
                </div>

                <!-- Ice Melt -->
                <div class="control-card">
                    <h3 class="text-xl font-semibold text-gray-700 mb-4 border-b pb-2"><i class="fas fa-icicles"></i> ìœ¡ì§€ ì–¼ìŒ ìœµí•´</h3>
                    <p class="text-xs text-gray-500 mb-4">ì§€êµ¬ ì˜¨ë‚œí™”ë¡œ ë…¹ì•„ë‚´ë¦´ ìœ¡ì§€ ë¹™í•˜(ë¹™ìƒ, ì‚°ì•…ë¹™í•˜)ì˜ ì´ëŸ‰ì„ ì¡°ì ˆí•˜ì„¸ìš”.</p>
                    <div>
                        <label for="iceMelt" class="block text-sm font-medium text-gray-700">2100ë…„ ì´ ìœµí•´ ì–¼ìŒ ì§ˆëŸ‰ (Gt): <span id="iceMeltLabel" class="font-bold text-blue-600">10000</span></label>
                        <input type="range" id="iceMelt" min="0" max="50000" value="10000" step="100" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                    </div>
                </div>
            </div>

            <!-- Right Panel: Results -->
            <div class="lg:col-span-2 space-y-6">
                <!-- Metrics -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="metric-card text-center">
                        <h4 class="text-lg font-semibold text-gray-500">ì—´íŒ½ì°½ ê¸°ì—¬ë„</h4>
                        <p id="thermalRise" class="text-4xl font-bold text-blue-600 mt-2">0.0 cm</p>
                    </div>
                    <div class="metric-card text-center">
                        <h4 class="text-lg font-semibold text-gray-500">ë¹™í•˜ìœµí•´ ê¸°ì—¬ë„</h4>
                        <p id="iceRise" class="text-4xl font-bold text-cyan-600 mt-2">0.0 cm</p>
                    </div>
                    <div class="metric-card text-center bg-gray-800 text-white">
                        <h4 class="text-lg font-semibold text-gray-300">ì´ í•´ìˆ˜ë©´ ìƒìŠ¹</h4>
                        <p id="totalRise" class="text-4xl font-bold mt-2">0.0 cm</p>
                    </div>
                </div>
                <!-- Chart -->
                <div class="bg-white p-4 sm:p-6 rounded-lg shadow-md h-96">
                    <canvas id="seaLevelChart"></canvas>
                </div>
                <!-- Korea Impact Map -->
                <div class="bg-white p-4 sm:p-6 rounded-lg shadow-md">
                    <h3 class="text-xl font-semibold text-gray-700 mb-4 border-b pb-2"><i class="fas fa-map-marked-alt"></i> í•œêµ­ í•´ìˆ˜ë©´ ìƒìŠ¹ ì‹œë®¬ë ˆì´ì…˜ ì§€ë„</h3>
                    <p class="text-xs text-gray-500 mb-4">
                        ì•„ë˜ ì§€ë„ëŠ” í•´ì–‘í™˜ê²½ê³µë‹¨(KOEM)ì—ì„œ ì œê³µí•˜ëŠ” í•´ìˆ˜ë©´ ìƒìŠ¹ ì‹œë®¬ë ˆì´í„°ì…ë‹ˆë‹¤.
                        <span class="font-bold text-blue-600">
                            ìœ„ì—ì„œ ê³„ì‚°ëœ ì´ í•´ìˆ˜ë©´ ìƒìŠ¹ ê°’: <span id="koreaTotalRiseMapRef" class="font-bold text-red-600">0.00 m</span>
                        </span>
                        <br>
                        ì´ ê°’ì„ ì°¸ê³ í•˜ì—¬ ì§€ë„ ì¢Œì¸¡ í•˜ë‹¨ì˜ ìŠ¬ë¼ì´ë”ë¥¼ ì¡°ì ˆí•˜ì—¬ í•´ë‹¹ ë†’ì´ì—ì„œì˜ ì¹¨ìˆ˜ ì§€ì—­ì„ ì‹œê°ì ìœ¼ë¡œ í™•ì¸í•´ ë³´ì„¸ìš”.
                        ì§€ë„ê°€ ë¡œë“œë˜ëŠ” ë° ì‹œê°„ì´ ê±¸ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                    </p>
                    <div class="w-full h-[700px] bg-gray-200 rounded-lg overflow-hidden border">
                        <iframe id="koemMapFrame" src="https://www.koem.or.kr/simulation/gmsl/rcp45.do" class="w-full h-full border-0" title="KOEM Sea Level Rise Simulator"></iframe>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- 1. ì´ˆê¸° ì„¤ì • ë° ë°ì´í„° ---
        const sspData = {
            "SSP1-2.6": { temp_rise_2100: 1.8, name: "ë§¤ìš° ë‚™ê´€ì " },
            "SSP2-4.5": { temp_rise_2100: 2.7, name: "ì¤‘ê°„" },
            "SSP5-8.5": { temp_rise_2100: 4.4, name: "ë§¤ìš° ë¹„ê´€ì " }
        };

        const oceanData = {
            pacific: { temp: 17, salinity: 34.5, depth: 4000 },
            atlantic: { temp: 15, salinity: 35.5, depth: 3600 },
            indian: { temp: 18, salinity: 34.8, depth: 3700 },
            southern: { temp: 0, salinity: 34.2, depth: 4000 },
            arctic: { temp: -1, salinity: 32, depth: 1200 },
            custom: { temp: 15, salinity: 35, depth: 3700 }
        };

        const OCEAN_AREA = 3.618e14; // m^2 (ì „ ì§€êµ¬ í•´ìˆ˜ë©´ì )
        const SEAWATER_DENSITY = 1025; // kg/m^3 (í•´ìˆ˜ í‰ê·  ë°€ë„)
        const GIGATON_TO_KG = 1e12; // 1 Gt = 10^12 kg
        const BASE_YEAR = 2020; // ê¸°ì¤€ ì—°ë„ë¥¼ 2020ìœ¼ë¡œ ë³€ê²½í•˜ì—¬ 2026ë¶€í„°ì˜ ë³€í™”ë¥¼ ê³„ì‚°

        const controls = {
            futureYear: document.getElementById('futureYear'),
            futureYearLabel: document.getElementById('futureYearLabel'),
            sspScenario: document.getElementById('sspScenario'),
            oceanTemp: document.getElementById('oceanTemp'),
            oceanTempLabel: document.getElementById('oceanTempLabel'),
            oceanSalinity: document.getElementById('oceanSalinity'),
            oceanSalinityLabel: document.getElementById('oceanSalinityLabel'),
            oceanDepth: document.getElementById('oceanDepth'),
            oceanDepthLabel: document.getElementById('oceanDepthLabel'),
            iceMelt: document.getElementById('iceMelt'),
            iceMeltLabel: document.getElementById('iceMeltLabel'),
            oceanButtons: document.querySelectorAll('.ocean-btn')
        };

        const displays = {
            thermalRise: document.getElementById('thermalRise'),
            iceRise: document.getElementById('iceRise'),
            totalRise: document.getElementById('totalRise'),
            // í•œêµ­ ì˜í–¥ ì„¹ì…˜ì˜ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸ë¥¼ ìœ„í•œ ìš”ì†Œ
            koreaTotalRiseMapRef: document.getElementById('koreaTotalRiseMapRef')
        };
        
        let chart;
        let isInitialized = false;

        // --- 2. ê³„ì‚° ë° ì—…ë°ì´íŠ¸ í•¨ìˆ˜ ---
        /**
         * í•´ìˆ˜ì˜ ì—´íŒ½ì°½ ê³„ìˆ˜ (alpha)ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤.
         * ì‹¤ì œ í•´ìˆ˜ì˜ ì—´íŒ½ì°½ ê³„ìˆ˜ëŠ” ì˜¨ë„, ì—¼ë¶„, ì••ë ¥ì— ë”°ë¼ ë³µì¡í•˜ê²Œ ë³€í•˜ì§€ë§Œ,
         * ì—¬ê¸°ì„œëŠ” ë‹¨ìˆœí™”ëœ ëª¨ë¸ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
         * @param {number} temp - ìˆ˜ì˜¨ (Â°C)
         * @param {number} salinity - ì—¼ë¶„ (PSU)
         * @returns {number} ì—´íŒ½ì°½ ê³„ìˆ˜
         */
        function calculateAlpha(temp, salinity) {
            // ì´ ê°’ë“¤ì€ ë‹¨ìˆœí™”ëœ ê·¼ì‚¬ì¹˜ì´ë©°, ì‹¤ì œ í•´ì–‘í•™ì  ëª¨ë¸ì€ í›¨ì”¬ ë³µì¡í•©ë‹ˆë‹¤.
            // ëŒ€ëµì ì¸ ê²½í–¥ì„±ì„ ë³´ì—¬ì£¼ê¸° ìœ„í•œ ê°’ì…ë‹ˆë‹¤.
            const baseAlpha = 7e-5; // 0Â°C, 35PSU ê¸°ì¤€ ê·¼ì‚¬ì¹˜
            const tempEffect = temp * 1.5e-6; // ì˜¨ë„ê°€ ë†’ì„ìˆ˜ë¡ ì—´íŒ½ì°½ë¥  ì¦ê°€
            const salinityEffect = (salinity - 35) * 5e-7; // ì—¼ë¶„ì´ ë†’ì„ìˆ˜ë¡ ì—´íŒ½ì°½ë¥  ì•½ê°„ ê°ì†Œ
            return baseAlpha + tempEffect - salinityEffect;
        }
        
        /**
         * íŠ¹ì • ì—°ë„ì— ëŒ€í•œ í•´ìˆ˜ë©´ ìƒìŠ¹ì„ ê³„ì‚°í•©ë‹ˆë‹¤.
         * @param {number} year - ì˜ˆì¸¡ ì—°ë„
         * @param {string} scenarioKey - SSP ì‹œë‚˜ë¦¬ì˜¤ í‚¤ (ì˜ˆ: "SSP2-4.5")
         * @param {number} temp - í‰ê·  ìˆ˜ì˜¨ (Â°C)
         * @param {number} salinity - í‰ê·  ì—¼ë¶„ (PSU)
         * @param {number} depth - í‰ê·  ìˆ˜ì‹¬ (m)
         * @param {number} iceMassGt2100 - 2100ë…„ê¹Œì§€ì˜ ì´ ì–¼ìŒ ìœµí•´ ì§ˆëŸ‰ (Gt)
         * @returns {object} ì—´íŒ½ì°½, ì–¼ìŒ ìœµí•´, ì´ í•´ìˆ˜ë©´ ìƒìŠ¹ (cm ë° m)
         */
        function calculateRiseForYear(year, scenarioKey, temp, salinity, depth, iceMassGt2100) {
            const totalYearsProjection = 2100 - BASE_YEAR; // 2020ë…„ë¶€í„° 2100ë…„ê¹Œì§€ì˜ ì´ ì˜ˆì¸¡ ê¸°ê°„
            const yearsPassed = year - BASE_YEAR; // ê¸°ì¤€ ì—°ë„ë¶€í„° í˜„ì¬ ì˜ˆì¸¡ ì—°ë„ê¹Œì§€ ê²½ê³¼í•œ ì‹œê°„
            
            // ì˜ˆì¸¡ ì—°ë„ê°€ ê¸°ì¤€ ì—°ë„ë³´ë‹¤ ì´ì „ì´ë©´ ìƒìŠ¹ ì—†ìŒ
            if (yearsPassed < 0) {
                return { thermal: 0, ice: 0, total: 0, total_m: 0 };
            }

            // ì „ ì§€êµ¬ í‰ê·  ê¸°ì˜¨ ìƒìŠ¹ (ì„ í˜• ì¦ê°€ ê°€ì •)
            const tempRise2100 = sspData[scenarioKey].temp_rise_2100; // 2100ë…„ê¹Œì§€ì˜ ì „ ì§€êµ¬ ê¸°ì˜¨ ìƒìŠ¹ (Â°C)
            const globalTempRise = (tempRise2100 / totalYearsProjection) * yearsPassed;
            
            // 1. í•´ìˆ˜ ì—´íŒ½ì°½ìœ¼ë¡œ ì¸í•œ í•´ìˆ˜ë©´ ìƒìŠ¹
            // í•´ìˆ˜ ì˜¨ë„ëŠ” ì „ ì§€êµ¬ ê¸°ì˜¨ ìƒìŠ¹ì˜ ì•½ 70% ì •ë„ë¥¼ ë°˜ì˜í•œë‹¤ê³  ê°€ì • (ë‹¨ìˆœí™”)
            const oceanTempRise = globalTempRise * 0.7; 
            const alpha = calculateAlpha(temp, salinity); // í˜„ì¬ ìˆ˜ì˜¨, ì—¼ë¶„ ê¸°ì¤€ ì—´íŒ½ì°½ ê³„ìˆ˜
            const thermalRise_m = alpha * oceanTempRise * depth; // ì—´íŒ½ì°½ìœ¼ë¡œ ì¸í•œ ìˆ˜ì‹¬ ì¦ê°€ (m)
            
            // 2. ìœ¡ì§€ ì–¼ìŒ ìœµí•´ë¡œ ì¸í•œ í•´ìˆ˜ë©´ ìƒìŠ¹
            // 2100ë…„ê¹Œì§€ì˜ ì´ ìœµí•´ ì–¼ìŒ ì§ˆëŸ‰ì„ ì„ í˜•ì ìœ¼ë¡œ ë¶„ë°°
            const iceMeltForYearGt = (iceMassGt2100 / totalYearsProjection) * yearsPassed;
            const iceMelt_kg = iceMeltForYearGt * GIGATON_TO_KG; // ê¸°ê°€í†¤ì„ kgìœ¼ë¡œ ë³€í™˜
            const iceRise_m = iceMelt_kg / (SEAWATER_DENSITY * OCEAN_AREA); // ì§ˆëŸ‰ì„ í•´ìˆ˜ë©´ì ê³¼ ë°€ë„ë¡œ ë‚˜ëˆ  ë†’ì´ (m) ê³„ì‚°
            
            // ì´ í•´ìˆ˜ë©´ ìƒìŠ¹
            const totalRise_m = thermalRise_m + iceRise_m;
            
            return {
                thermal: thermalRise_m * 100, // cmë¡œ ë³€í™˜
                ice: iceRise_m * 100, // cmë¡œ ë³€í™˜
                total: totalRise_m * 100, // cmë¡œ ë³€í™˜
                total_m: totalRise_m // m
            };
        }

        /**
         * í•œêµ­ í•´ì•ˆì„  ë³€í™” ì˜ˆì¸¡ ì„¹ì…˜ì˜ í…ìŠ¤íŠ¸ë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
         * ì§€ë„ëŠ” ìì²´ ì»¨íŠ¸ë¡¤ì„ ì‚¬ìš©í•˜ë¯€ë¡œ, ì—¬ê¸°ì„œëŠ” ê³„ì‚°ëœ ê°’ë§Œ ì°¸ì¡°ë¡œ ì œê³µí•©ë‹ˆë‹¤.
         * @param {number} totalRise_m - ì´ í•´ìˆ˜ë©´ ìƒìŠ¹ (m)
         */
        function updateKoreanMapReference(totalRise_m) {
            displays.koreaTotalRiseMapRef.textContent = `${totalRise_m.toFixed(2)} m`; // ë¯¸í„° ë‹¨ìœ„ë¡œ í‘œì‹œ
        }

        /**
         * ì‹œë®¬ë ˆì´ì…˜ì˜ ëª¨ë“  ê°’ì„ ì—…ë°ì´íŠ¸í•˜ê³  ê²°ê³¼ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.
         */
        function updateSimulation() {
            if (!isInitialized) return; // ì°¨íŠ¸ ì´ˆê¸°í™” ì „ì—ëŠ” ì—…ë°ì´íŠ¸í•˜ì§€ ì•ŠìŒ

            const year = parseInt(controls.futureYear.value);
            const scenarioKey = controls.sspScenario.value;
            const temp = parseFloat(controls.oceanTemp.value);
            const salinity = parseFloat(controls.oceanSalinity.value);
            const depth = parseInt(controls.oceanDepth.value);
            const iceMassGt = parseInt(controls.iceMelt.value);

            // ìŠ¬ë¼ì´ë” ë¼ë²¨ ì—…ë°ì´íŠ¸
            controls.futureYearLabel.textContent = year;
            controls.oceanTempLabel.textContent = temp.toFixed(1);
            controls.oceanSalinityLabel.textContent = salinity.toFixed(1);
            controls.oceanDepthLabel.textContent = depth;
            controls.iceMeltLabel.textContent = iceMassGt.toLocaleString();

            // í˜„ì¬ ì„¤ì •ì— ë”°ë¥¸ í•´ìˆ˜ë©´ ìƒìŠ¹ ê³„ì‚°
            const result = calculateRiseForYear(year, scenarioKey, temp, salinity, depth, iceMassGt);

            // ê²°ê³¼ ê°’ í‘œì‹œ ì—…ë°ì´íŠ¸
            displays.thermalRise.textContent = `${result.thermal.toFixed(2)} cm`;
            displays.iceRise.textContent = `${result.ice.toFixed(2)} cm`;
            displays.totalRise.textContent = `${result.total.toFixed(2)} cm`;

            // ì°¨íŠ¸ ì—…ë°ì´íŠ¸
            updateChart();
            
            // í•œêµ­ ì§€ë„ ì°¸ì¡° í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸ (ë¯¸í„° ë‹¨ìœ„)
            updateKoreanMapReference(result.total_m);
        }

        // --- 3. ì°¨íŠ¸ í•¨ìˆ˜ ---
        /**
         * Chart.jsë¥¼ ì‚¬ìš©í•˜ì—¬ í•´ìˆ˜ë©´ ìƒìŠ¹ ì˜ˆì¸¡ ì°¨íŠ¸ë¥¼ ì´ˆê¸°í™”í•©ë‹ˆë‹¤.
         */
        function initializeChart() {
            const ctx = document.getElementById('seaLevelChart').getContext('2d');
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [], // ì—°ë„ ë¼ë²¨
                    datasets: [
                        {
                            label: 'ë§¤ìš° ë‚™ê´€ì  (SSP1-2.6)',
                            data: [],
                            borderColor: 'rgba(34, 197, 94, 0.8)', // Tailwind green-500
                            backgroundColor: 'rgba(34, 197, 94, 0.1)',
                            fill: false, tension: 0.1, borderWidth: 2
                        },
                        {
                            label: 'ì¤‘ê°„ ì‹œë‚˜ë¦¬ì˜¤ (SSP2-4.5)',
                            data: [],
                            borderColor: 'rgba(234, 179, 8, 0.8)', // Tailwind yellow-500
                            backgroundColor: 'rgba(234, 179, 8, 0.1)',
                            fill: false, tension: 0.1, borderWidth: 2
                        },
                        {
                            label: 'ë§¤ìš° ë¹„ê´€ì  (SSP5-8.5)',
                            data: [],
                            borderColor: 'rgba(239, 68, 68, 0.8)', // Tailwind red-500
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            fill: false, tension: 0.1, borderWidth: 2
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false, // ì»¨í…Œì´ë„ˆ í¬ê¸°ì— ë§ì¶° ë¹„ìœ¨ ì¡°ì •
                    scales: {
                        x: { 
                            title: { display: true, text: 'ì—°ë„' },
                            grid: { display: false } // Xì¶• ê·¸ë¦¬ë“œ ë¼ì¸ ìˆ¨ê¸°ê¸°
                        },
                        y: { 
                            title: { display: true, text: 'ì´ í•´ìˆ˜ë©´ ìƒìŠ¹ (cm)' }, 
                            beginAtZero: true,
                            grid: { color: 'rgba(0, 0, 0, 0.05)' } // Yì¶• ê·¸ë¦¬ë“œ ë¼ì¸ ì—°í•˜ê²Œ
                        }
                    },
                    plugins: {
                        tooltip: { 
                            mode: 'index', 
                            intersect: false,
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.y !== null) {
                                        label += context.parsed.y.toFixed(2) + ' cm';
                                    }
                                    return label;
                                }
                            }
                        },
                        legend: { 
                            position: 'top',
                            labels: {
                                font: {
                                    size: 12
                                }
                            }
                        },
                        title: { 
                            display: true, 
                            text: 'ì‹œë‚˜ë¦¬ì˜¤ë³„ í•´ìˆ˜ë©´ ìƒìŠ¹ ì˜ˆì¸¡ ë¹„êµ', 
                            font: { size: 16, weight: 'bold' },
                            color: '#333'
                        }
                    }
                }
            });
        }

        /**
         * í˜„ì¬ ì‹œë®¬ë ˆì´ì…˜ ì„¤ì •ì— ë”°ë¼ ì°¨íŠ¸ ë°ì´í„°ë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
         */
        function updateChart() {
            if (!chart) return; // ì°¨íŠ¸ê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìœ¼ë©´ ì‹¤í–‰í•˜ì§€ ì•ŠìŒ

            const temp = parseFloat(controls.oceanTemp.value);
            const salinity = parseFloat(controls.oceanSalinity.value);
            const depth = parseInt(controls.oceanDepth.value);
            const iceMassGt = parseInt(controls.iceMelt.value);
            
            const endYear = 2100;
            const labels = [];
            const scenarioData = { "SSP1-2.6": [], "SSP2-4.5": [], "SSP5-8.5": [] };

            // ê¸°ì¤€ ì—°ë„ë¶€í„° 2100ë…„ê¹Œì§€ì˜ ë°ì´í„°ë¥¼ ê³„ì‚°í•˜ì—¬ ì°¨íŠ¸ì— ë°˜ì˜
            for (let year = BASE_YEAR; year <= endYear; year++) {
                labels.push(year);
                for (const key in scenarioData) {
                    const result = calculateRiseForYear(year, key, temp, salinity, depth, iceMassGt);
                    scenarioData[key].push(result.total);
                }
            }
            
            // Yì¶•ì˜ ìµœëŒ€ê°’ì„ ë°ì´í„°ì— ë”°ë¼ ë™ì ìœ¼ë¡œ ì¡°ì •
            const allData = Object.values(scenarioData).flat();
            const dataMax = Math.max(...allData);
            // ìµœëŒ€ê°’ì˜ 120%ë¥¼ 10ì˜ ë°°ìˆ˜ë¡œ ì˜¬ë¦¼í•˜ì—¬ ì—¬ìœ  ìˆëŠ” Yì¶• ë²”ìœ„ ì„¤ì •
            const suggestedMax = Math.ceil((dataMax * 1.2) / 10) * 10;
            chart.options.scales.y.max = suggestedMax;
            chart.options.scales.y.min = 0; // Yì¶• ìµœì†Œê°’ì€ 0

            // ì°¨íŠ¸ ë°ì´í„° ì—…ë°ì´íŠ¸
            chart.data.labels = labels;
            chart.data.datasets[0].data = scenarioData["SSP1-2.6"];
            chart.data.datasets[1].data = scenarioData["SSP2-4.5"];
            chart.data.datasets[2].data = scenarioData["SSP5-8.5"];
            chart.update(); // ì°¨íŠ¸ ë‹¤ì‹œ ê·¸ë¦¬ê¸°
        }

        // --- 4. ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ---
        // ëª¨ë“  ìŠ¬ë¼ì´ë”ì™€ ì‹œë‚˜ë¦¬ì˜¤ ì„ íƒ ë“œë¡­ë‹¤ìš´ì— 'input' ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
        ['futureYear', 'sspScenario', 'oceanTemp', 'oceanSalinity', 'oceanDepth', 'iceMelt'].forEach(key => {
            controls[key].addEventListener('input', updateSimulation);
        });

        // í•´ì–‘ ë²„íŠ¼ì— 'click' ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
        controls.oceanButtons.forEach(button => {
            button.addEventListener('click', (e) => {
                // ëª¨ë“  ë²„íŠ¼ì˜ 'active' í´ë˜ìŠ¤ ì œê±°
                controls.oceanButtons.forEach(btn => btn.classList.remove('active'));
                // í´ë¦­ëœ ë²„íŠ¼ì— 'active' í´ë˜ìŠ¤ ì¶”ê°€
                e.target.classList.add('active');

                const ocean = e.target.dataset.ocean;
                // 'ì§ì ‘ì…ë ¥'ì´ ì•„ë‹Œ ê²½ìš° í•´ë‹¹ ë°”ë‹¤ì˜ ê¸°ë³¸ê°’ìœ¼ë¡œ ìŠ¬ë¼ì´ë” ì„¤ì •
                if (ocean !== 'custom') {
                    const data = oceanData[ocean];
                    controls.oceanTemp.value = data.temp;
                    controls.oceanSalinity.value = data.salinity;
                    controls.oceanDepth.value = data.depth;
                }
                updateSimulation(); // ì‹œë®¬ë ˆì´ì…˜ ì—…ë°ì´íŠ¸
            });
        });

        // --- 5. ì´ˆê¸° ì‹¤í–‰ ---
        // í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ ì‹œ ì°¨íŠ¸ ì´ˆê¸°í™” ë° ì‹œë®¬ë ˆì´ì…˜ ì‹œì‘
        window.onload = () => {
            initializeChart(); // ì°¨íŠ¸ ì´ˆê¸°í™”
            isInitialized = true; // ì´ˆê¸°í™” ì™„ë£Œ í”Œë˜ê·¸ ì„¤ì •
            
            // ì´ˆê¸° ë¡œë“œ ì‹œ 'ì§ì ‘ì…ë ¥' ë°”ë‹¤ì˜ ê¸°ë³¸ê°’ìœ¼ë¡œ ìŠ¬ë¼ì´ë” ì„¤ì • í›„ ì‹œë®¬ë ˆì´ì…˜ ì‹¤í–‰
            const initialData = oceanData.custom;
            controls.oceanTemp.value = initialData.temp;
            controls.oceanSalinity.value = initialData.salinity;
            controls.oceanDepth.value = initialData.depth;
            updateSimulation(); 
        };

    </script>
</body>
</html>```

